# P: Safe Asynchronous Event-Driven Programming

### 1 Abstract

#### 设计理念

* 统一建模与编程：\
  P语言讲状态机和实际编程结合，允许开发者以状态机交互的方式描述系统行为。系统被定义为多个状态机的集合，通过事件通信实现异步逻辑。
* 目标场景：\
  适用于高并发、事件驱动的系统（如设备驱动，网络协议栈），需保证响应性和可靠性。

#### 核心机制

* **状态机与事件驱动​**
  * **状态机模型​**​：\
    每个组件是一个状态机，通过发送/接收事件与其他状态机交互。事件处理逻辑与状态绑定。
  * 事件处理规则：\
    ​**​默认安全性​**​：要求每个状态必须处理所有可能到达的事件（避免事件丢失）。\
    **延迟事件（Deferred Events）​**​：开发者可标记特定事件为“延迟处理”，允许在合适的状态下再处理。

幽灵机（Ghosts Machines）

​**非确定性环境建模​**

测试时通过幽灵机模拟外部环境（如硬件或不可控输入），生成非确定性事件序列以覆盖复杂场景。​

**零运行时开销​**​：

幽灵机仅在编译前用于验证，生成可执行代码时被擦除，由类型系统保证擦除后的语义一致性。

**3）验证与编译​​**

* ​**​形式化验证​**​：
  * ​**​模型检查（Model Checking）​**​：验证系统是否满足安全性（如无死锁）和活跃性（如事件不被无限延迟）。
  * ​**​响应性保证​**​：确保系统能及时处理所有事件，避免资源耗尽或响应延迟。
* ​**​可执行代码生成​**​：\
  P 程序可直接编译为高效代码，同时保留验证阶段的安全性证明。

